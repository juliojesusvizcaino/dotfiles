#!/usr/bin/bash


if ! [ -x "$(command -v ansible)" ]; then
    sudo apt install ansible -y
fi

####################
# TERMINAL THINGS
# - tmux
if ! [ -x "$(command -v tmux)" ]; then
    sudo apt install tmux -y
fi
# - starship
if ! [ -x "$(command -v starship)" ]; then
    curl -sS https://starship.rs/install.sh | sh
fi

# - alacritty
if ! [ -x "$(command -v alacritty)" ]; then
    # first rust
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    # clone alacritty
    cd /tmp
    git clone https://github.com/alacritty/alacritty.git
    cd alacritty
    # install dependencies
    apt-get install cmake pkg-config libfreetype6-dev libfontconfig1-dev libxcb-xfixes0-dev libxkbcommon-dev python3
    # compile alacritty
    cargo build --release
    # desktop entry
    sudo cp target/release/alacritty /usr/local/bin # or anywhere else in $PATH
    sudo cp extra/logo/alacritty-term.svg /usr/share/pixmaps/Alacritty.svg
    sudo desktop-file-install extra/linux/Alacritty.desktop
    sudo update-desktop-database
    # set as default terminal
    sudo update-alternatives --install /usr/bin/x-terminal-emulator x-terminal-emulator $(which alacritty) 50
    sudo update-alternatives --config x-terminal-emulator
fi
####################


# ripgrep
if ! [ -x "$(command -v rg)" ]; then
    cd /tmp
    curl -LO https://github.com/BurntSushi/ripgrep/releases/download/13.0.0/ripgrep_13.0.0_amd64.deb
    sudo dpkg -i ripgrep_13.0.0_amd64.deb
fi

# zoxide
if ! [ -x "$(command -v z)" ]; then
    curl -sS https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | bash
fi

# fzf
if ! [ -x "$(command -v fzf)" ]; then
    git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
    ~/.fzf/install
fi


####################
# DEVELOPMENT
#
# - node
if ! [ -x "$(command -v volta)" ]; then
    curl https://get.volta.sh | bash
    volta install node
fi

# - python
if ! [ -x "$(command -v pyenv)" ]; then
    curl https://pyenv.run | bash
    set -Ux PYENV_ROOT $HOME/.pyenv
    set -U fish_user_paths $PYENV_ROOT/bin $fish_user_paths
fi

# dotfiles
if ! [ -x "$(command -v stow)" ]; then
    sudo apt install stow
fi
cd $HOME/.dotfiles
stow .

####################
# neovim things
npm install -g neovim @johnnymorganz/stylua-bin
pip install --user --upgrade pynvim black isort ipython
cargo install tree-sitter-cli
####################

# tmux
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

echo "Complete!"
